name: Hourly Channel Update

on:
  schedule:
    # Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± ÙŠØ¹Ù†ÙŠ: ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª ÙƒÙ„ Ø³Ø§Ø¹Ø© (Ø¹Ù„Ù‰ Ø±Ø£Ø³ Ø§Ù„Ø³Ø§Ø¹Ø©)
    - cron: '0 * * * *'
  workflow_dispatch: # ÙŠØ¶ÙŠÙ Ø²Ø± ÙÙŠ GitHub Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù…ØªÙ‰ Ø´Ø¦Øª

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Ø¥Ø°Ù† Ù„Ù„ÙƒØªØ§Ø¨Ø© ÙˆØ­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0 # Ù…Ù‡Ù… Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙÙŠ Git

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests

      - name: Run Crawler
        run: python update.py

      - name: Commit and Push
        run: |
          git config --global user.name 'Hamza TV Bot'
          git config --global user.email 'bot@hamza-tv.com'
          git add channels.json
          # Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø± Ø§Ù„Ø°ÙƒÙŠ ÙŠØªØ­Ù‚Ù‚: Ù‡Ù„ ØªØºÙŠØ±Øª Ø§Ù„Ù‚Ù†ÙˆØ§ØªØŸ Ø¥Ø°Ø§ Ù†Ø¹Ù…ØŒ Ø§Ø­ÙØ¸Ù‡Ø§. Ø¥Ø°Ø§ Ù„Ø§ØŒ Ù„Ø§ ØªÙØ¹Ù„ Ø´ÙŠØ¦Ø§Ù‹.
          git diff --quiet && git diff --staged --quiet || (git commit -m "ğŸš€ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ" && git pull --rebase && git push)
