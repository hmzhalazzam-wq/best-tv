<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hamza TV Ultimate</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a1a1a">
    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;600;900&display=swap" rel="stylesheet">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HCNJRN7GQ6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-HCNJRN7GQ6');
    </script>

    <style>
        :root { --primary: #e50914; --bg: #0f0f0f; --text: #fff; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background: var(--bg); color: var(--text); font-family: 'Cairo', sans-serif; margin: 0; padding-bottom: 80px; }
        
        /* Hero Section (Ø§Ù„Ø¨Ø§Ù†Ø± Ø§Ù„ÙƒØ¨ÙŠØ±) */
        .hero { height: 40vh; max-height: 400px; position: relative; display: flex; align-items: flex-end; padding: 20px; background: linear-gradient(to top, #0f0f0f, transparent), url('https://wallpaperaccess.com/full/2157022.jpg'); background-size: cover; background-position: center; }
        .hero-content { z-index: 2; width: 100%; }
        .hero-title { font-size: 2.5rem; margin: 0; font-weight: 900; text-shadow: 0 2px 10px rgba(0,0,0,0.8); }
        .hero-desc { font-size: 0.9rem; color: #ddd; margin: 5px 0 15px 0; max-width: 80%; }
        .hero-btn { background: var(--primary); color: white; border: none; padding: 10px 25px; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 1rem; display: inline-flex; align-items: center; gap: 5px; transition: 0.3s; }
        .hero-btn:hover { transform: scale(1.05); }

        /* Search & Cats */
        .controls { position: sticky; top: 0; background: rgba(15,15,15,0.95); backdrop-filter: blur(10px); z-index: 50; padding: 10px 0; border-bottom: 1px solid #333; }
        .search-box { width: 90%; margin: 0 auto 10px auto; display: block; padding: 12px; border-radius: 8px; border: 1px solid #333; background: #222; color: white; font-family: inherit; }
        .cats { display: flex; gap: 10px; overflow-x: auto; padding: 0 15px 10px 15px; scrollbar-width: none; }
        .chip { background: #333; padding: 6px 16px; border-radius: 20px; font-size: 13px; cursor: pointer; white-space: nowrap; transition: 0.3s; border: 1px solid transparent; color: #ccc; }
        .chip.active { background: white; color: black; font-weight: bold; }

        /* Grid */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 10px; padding: 15px; }
        .card { background: #1a1a1a; border-radius: 8px; padding: 10px; position: relative; cursor: pointer; transition: 0.3s; border: 1px solid transparent; display: flex; flex-direction: column; align-items: center; height: 140px; }
        .card:hover { border-color: #555; background: #252525; }
        .logo-wrapper { width: 60px; height: 60px; background: white; border-radius: 50%; padding: 5px; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
        .card img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .card h3 { font-size: 12px; text-align: center; margin: 0; color: #eee; line-height: 1.3; }
        .live-badge { position: absolute; top: 8px; left: 8px; width: 8px; height: 8px; background: #00ff00; border-radius: 50%; box-shadow: 0 0 10px #00ff00; }
        .fav-btn { position: absolute; top: 5px; right: 5px; font-size: 18px; color: #444; z-index: 2; padding: 5px; }
        .fav-btn.active { color: var(--primary); }

        /* Player Modal */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 1000; display: none; flex-direction: column; justify-content: center; }
        .modal-header { position: absolute; top: 0; width: 100%; padding: 20px; display: flex; justify-content: space-between; z-index: 1001; background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent); }
        .close-btn { color: white; background: rgba(255,255,255,0.2); border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; backdrop-filter: blur(5px); }
        .status { position: absolute; bottom: 30px; width: 100%; text-align: center; color: #888; font-size: 14px; }

        /* Loading */
        .loader { text-align: center; padding: 50px; color: #666; }
    </style>
</head>
<body>

    <!-- Ø§Ù„Ø¨Ø§Ù†Ø± Ø§Ù„Ù…ØªØ­Ø±Ùƒ -->
    <div class="hero">
        <div class="hero-content">
            <h1 class="hero-title">Ø¨Ø« Ù…Ø¨Ø§Ø´Ø±</h1>
            <p class="hero-desc">Ø´Ø§Ù‡Ø¯ Ø¢Ù„Ø§Ù Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©ØŒ Ù…Ø¨Ø§Ø±ÙŠØ§ØªØŒ Ø£ÙÙ„Ø§Ù…ØŒ ÙˆØ§Ù„Ù…Ø²ÙŠØ¯ ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯.</p>
            <button class="hero-btn" onclick="document.querySelector('.controls').scrollIntoView({behavior:'smooth'})">
                â–¶ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
            </button>
        </div>
    </div>

    <div class="controls">
        <input type="text" class="search-box" id="search" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù‚Ù†Ø§Ø©..." onkeyup="filter()">
        <div class="cats">
            <div class="chip active" onclick="setCat('all', this)">Ø§Ù„ÙƒÙ„</div>
            <div class="chip" onclick="setCat('fav', this)">â¤ï¸ Ø§Ù„Ù…ÙØ¶Ù„Ø©</div>
            <div class="chip" onclick="setCat('sports', this)">âš½ Ø±ÙŠØ§Ø¶Ø©</div>
            <div class="chip" onclick="setCat('news', this)">ğŸ“° Ø£Ø®Ø¨Ø§Ø±</div>
            <div class="chip" onclick="setCat('movies', this)">ğŸ¬ Ø£ÙÙ„Ø§Ù…</div>
            <div class="chip" onclick="setCat('kids', this)">ğŸ§¸ Ø£Ø·ÙØ§Ù„</div>
            <div class="chip" onclick="setCat('docu', this)">ğŸŒ ÙˆØ«Ø§Ø¦Ù‚ÙŠ</div>
        </div>
    </div>

    <div class="grid" id="grid"></div>
    <div class="loader" id="loader">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù‚Ù†ÙˆØ§Øª...</div>

    <div class="modal" id="modal">
        <div class="modal-header">
            <span style="color:white; font-weight:bold; margin-top:5px;" id="playing-name"></span>
            <button class="close-btn" onclick="closePlayer()">âœ• Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
        <video id="player" playsinline controls></video>
        <div class="status" id="status"></div>
    </div>

    <script>
        let allData = [];
        let favs = JSON.parse(localStorage.getItem('favs_v5')) || [];
        let player;

        document.addEventListener('DOMContentLoaded', () => {
            player = new Plyr('#player', { controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'fullscreen'] });
        });

        fetch('channels.json?' + Date.now()).then(r => r.json()).then(d => {
            allData = d;
            document.getElementById('loader').style.display = 'none';
            render(allData);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø§Ù†Ø± Ø¨Ù‚Ù†Ø§Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© (Ø­Ø±ÙƒØ© Ø¬Ù…Ø§Ù„ÙŠØ©)
            let randomCh = allData[Math.floor(Math.random() * allData.length)];
            if(randomCh && randomCh.logo) {
                // ÙŠÙ…ÙƒÙ† Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹ ÙˆØ¶Ø¹ ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ù‡Ù†Ø§
            }
        });

        function render(list) {
            const grid = document.getElementById('grid');
            grid.innerHTML = "";
            list.slice(0, 300).forEach(ch => {
                let isFav = favs.includes(ch.name);
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµÙˆØ±Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø£Ù†ÙŠÙ‚Ø© Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø©
                let logo = ch.logo || "https://cdn-icons-png.flaticon.com/512/2503/2503508.png";
                
                let div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <div class="live-badge"></div>
                    <div class="fav-btn ${isFav ? 'active' : ''}" onclick="toggleFav('${ch.name}', event)">â™¥</div>
                    <div class="logo-wrapper"><img src="${logo}" loading="lazy" onerror="this.src='https://cdn-icons-png.flaticon.com/512/2503/2503508.png'"></div>
                    <h3>${ch.name}</h3>
                `;
                div.onclick = (e) => { if(!e.target.classList.contains('fav-btn')) openPlayer(ch); };
                grid.appendChild(div);
            });
        }

        function openPlayer(ch) {
            document.getElementById('modal').style.display = 'flex';
            document.getElementById('playing-name').innerText = ch.name;
            let urls = ch.urls;
            let idx = 0;
            const status = document.getElementById('status');
            const video = document.getElementById('player');

            function playNext() {
                if(idx >= urls.length) {
                    status.innerText = "âŒ Ù†Ø¹ØªØ°Ø±ØŒ Ø§Ù„Ø¨Ø« ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹";
                    return;
                }
                status.innerText = `Ø¬Ø§Ø±ÙŠ ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…ØµØ¯Ø± ${idx + 1}...`;
                let url = urls[idx];

                if (Hls.isSupported()) {
                    let hls = new Hls();
                    hls.loadSource(url);
                    hls.attachMedia(video);
                    hls.on(Hls.Events.MANIFEST_PARSED, () => {
                        status.innerText = "";
                        player.play();
                    });
                    hls.on(Hls.Events.ERROR, (e, data) => {
                        if(data.fatal) {
                            hls.destroy();
                            idx++;
                            playNext();
                        }
                    });
                } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    video.src = url;
                    video.play();
                    video.onerror = () => { idx++; playNext(); };
                }
            }
            playNext();
        }

        function closePlayer() {
            document.getElementById('modal').style.display = 'none';
            player.stop();
        }

        function toggleFav(name, e) {
            e.stopPropagation();
            if(favs.includes(name)) favs = favs.filter(n => n !== name);
            else favs.push(name);
            localStorage.setItem('favs_v5', JSON.stringify(favs));
            let activeCat = document.querySelector('.chip.active').innerText;
            if(activeCat.includes("Ø§Ù„Ù…ÙØ¶Ù„Ø©")) {
                 render(allData.filter(x => favs.includes(x.name)));
            } else {
                 e.target.classList.toggle('active');
            }
        }

        function setCat(cat, btn) {
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            btn.classList.add('active');
            let res = (cat === 'all') ? allData : (cat === 'fav') ? allData.filter(x => favs.includes(x.name)) : allData.filter(x => x.category === cat);
            render(res);
        }

        function filter() {
            let q = document.getElementById('search').value.toLowerCase();
            render(allData.filter(x => x.name.toLowerCase().includes(q)));
        }
    </script>
</body>
</html>
