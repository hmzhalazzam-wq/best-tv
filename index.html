<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hamza TV Platinum</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#00b3ff">
    
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Alexandria:wght@300;500;800&display=swap" rel="stylesheet">
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HCNJRN7GQ6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-HCNJRN7GQ6');
    </script>

    <style>
        :root { --main-color: #00b3ff; --bg-color: #0a0a0a; --card-bg: #161616; }
        body { background-color: var(--bg-color); color: #fff; font-family: 'Alexandria', sans-serif; margin: 0; padding-bottom: 80px; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header { padding: 15px; position: sticky; top: 0; background: rgba(10,10,10,0.95); z-index: 50; border-bottom: 1px solid #222; backdrop-filter: blur(10px); display: flex; align-items: center; gap: 10px; }
        .search-container { flex-grow: 1; position: relative; }
        .search-input { width: 100%; background: #222; border: 1px solid #333; padding: 10px 40px 10px 15px; border-radius: 12px; color: white; font-family: inherit; }
        .search-input:focus { border-color: var(--main-color); outline: none; }
        
        /* Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª */
        .tags-bar { display: flex; gap: 8px; overflow-x: auto; padding: 15px; scrollbar-width: none; }
        .tags-bar::-webkit-scrollbar { display: none; }
        .tag { background: #222; padding: 8px 16px; border-radius: 30px; font-size: 13px; cursor: pointer; white-space: nowrap; transition: 0.3s; border: 1px solid transparent; }
        .tag.active { background: var(--main-color); color: black; font-weight: bold; box-shadow: 0 0 15px rgba(0, 179, 255, 0.4); }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ù‚Ù†ÙˆØ§Øª */
        .channels-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 12px; padding: 15px; }
        .channel-card { background: var(--card-bg); border-radius: 12px; padding: 15px 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 140px; position: relative; cursor: pointer; border: 1px solid #222; transition: 0.3s; }
        .channel-card:hover { transform: translateY(-5px); border-color: var(--main-color); background: #202020; }
        .channel-logo { width: 60px; height: 60px; object-fit: contain; margin-bottom: 10px; border-radius: 50%; background: #fff; padding: 5px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .channel-name { font-size: 12px; text-align: center; color: #ccc; margin: 0; line-height: 1.4; }
        
        /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø© ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø· */
        .fav-heart { position: absolute; top: 8px; left: 8px; font-size: 18px; color: #444; z-index: 2; transition: 0.2s; }
        .fav-heart.active { color: #ff0055; transform: scale(1.2); }
        .badge { position: absolute; bottom: 8px; right: 8px; font-size: 10px; background: #333; padding: 2px 6px; border-radius: 4px; color: #888; }
        
        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø´ØºÙ„ */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 100; display: none; align-items: center; justify-content: center; flex-direction: column; }
        .video-wrapper { width: 100%; max-width: 900px; padding: 10px; }
        .close-btn { position: absolute; top: 20px; left: 20px; background: rgba(255,255,255,0.15); color: white; border: none; padding: 8px 20px; border-radius: 30px; cursor: pointer; z-index: 101; backdrop-filter: blur(5px); font-weight: bold; }
        .status-text { margin-top: 10px; color: #888; font-size: 14px; }
        
        /* ØªØµÙ…ÙŠÙ… Plyr Ø§Ù„Ù…Ø®ØµØµ */
        .plyr { border-radius: 10px; overflow: hidden; box-shadow: 0 0 50px rgba(0, 179, 255, 0.1); --plyr-color-main: #00b3ff; }
    </style>
</head>
<body>

    <div class="header">
        <div class="search-container">
            <input type="text" class="search-input" id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù‚Ù†Ø§Ø©..." onkeyup="filterChannels()">
        </div>
    </div>

    <div class="tags-bar">
        <div class="tag active" onclick="filterCat('all', this)">Ø§Ù„ÙƒÙ„</div>
        <div class="tag" onclick="filterCat('fav', this)">â¤ï¸ Ø§Ù„Ù…ÙØ¶Ù„Ø©</div>
        <div class="tag" onclick="filterCat('sports', this)">âš½ Ø±ÙŠØ§Ø¶Ø©</div>
        <div class="tag" onclick="filterCat('news', this)">ğŸ“° Ø£Ø®Ø¨Ø§Ø±</div>
        <div class="tag" onclick="filterCat('movies', this)">ğŸ¬ Ø£ÙÙ„Ø§Ù…</div>
        <div class="tag" onclick="filterCat('kids', this)">ğŸ§¸ Ø£Ø·ÙØ§Ù„</div>
        <div class="tag" onclick="filterCat('docu', this)">ğŸ¦ ÙˆØ«Ø§Ø¦Ù‚ÙŠ</div>
    </div>

    <div class="channels-grid" id="grid"></div>
    <div style="text-align:center; padding:40px; color:#555;" id="msg">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª...</div>

    <div class="overlay" id="player-modal">
        <button class="close-btn" onclick="closePlayer()">âœ• Ø®Ø±ÙˆØ¬</button>
        <div class="video-wrapper">
            <video id="player" playsinline controls></video>
        </div>
        <div class="status-text" id="status">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</div>
    </div>

    <script>
        let allData = [];
        let favs = JSON.parse(localStorage.getItem('favs_v4')) || [];
        let player; // Ù…ØªØºÙŠØ± Ø§Ù„Ù…Ø´ØºÙ„

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø´ØºÙ„ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        document.addEventListener('DOMContentLoaded', () => {
            player = new Plyr('#player', {
                controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'settings', 'pip', 'fullscreen'],
                settings: ['quality', 'speed']
            });
        });

        // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        fetch('channels.json?' + Date.now())
            .then(r => r.json())
            .then(data => {
                allData = data;
                document.getElementById('msg').style.display = 'none';
                render(allData);
            })
            .catch(() => document.getElementById('msg').innerText = "Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©ØŒ ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª.");

        function render(list) {
            const grid = document.getElementById('grid');
            grid.innerHTML = "";
            list.slice(0, 150).forEach(ch => {
                let isFav = favs.includes(ch.name);
                let logo = ch.logo || "https://cdn-icons-png.flaticon.com/512/2503/2503508.png";
                let count = ch.urls.length;
                
                let div = document.createElement('div');
                div.className = 'channel-card';
                div.innerHTML = `
                    <div class="fav-heart ${isFav ? 'active' : ''}" onclick="toggleFav('${ch.name}', event)">â™¥</div>
                    <img src="${logo}" class="channel-logo" loading="lazy" onerror="this.src='https://cdn-icons-png.flaticon.com/512/2503/2503508.png'">
                    <h3 class="channel-name">${ch.name}</h3>
                    <span class="badge">${count} Ø³ÙŠØ±ÙØ±</span>
                `;
                div.onclick = (e) => { if(!e.target.classList.contains('fav-heart')) openChannel(ch); };
                grid.appendChild(div);
            });
        }

        // --- Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ ÙˆØ§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ---
        function openChannel(ch) {
            document.getElementById('player-modal').style.display = 'flex';
            const status = document.getElementById('status');
            const video = document.getElementById('player');
            
            let urls = ch.urls;
            let currentIdx = 0;

            function tryUrl() {
                if(currentIdx >= urls.length) {
                    status.innerText = "âŒ Ø¬Ù…ÙŠØ¹ Ø±ÙˆØ§Ø¨Ø· Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ù†Ø§Ø© Ù…ØªÙˆÙ‚ÙØ© Ø­Ø§Ù„ÙŠØ§Ù‹.";
                    return;
                }
                
                let url = urls[currentIdx];
                status.innerText = `â³ ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø³ÙŠØ±ÙØ± Ø±Ù‚Ù… ${currentIdx + 1} Ù…Ù† ${urls.length}...`;
                
                if (Hls.isSupported()) {
                    let hls = new Hls();
                    hls.loadSource(url);
                    hls.attachMedia(video);
                    
                    hls.on(Hls.Events.MANIFEST_PARSED, () => {
                        status.innerText = "âœ… ØªÙ… Ø§Ù„ØªØ´ØºÙŠÙ„!";
                        player.play();
                    });
                    
                    // Ø¥Ø°Ø§ Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø§Ù†ØªÙ‚Ù„ ÙÙˆØ±Ø§Ù‹ Ù„Ù„Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ§Ù„ÙŠ
                    hls.on(Hls.Events.ERROR, (event, data) => {
                        if (data.fatal) {
                            console.log("ÙØ´Ù„ Ø§Ù„Ø±Ø§Ø¨Ø·ØŒ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØªØ§Ù„ÙŠ...");
                            hls.destroy();
                            currentIdx++;
                            tryUrl();
                        }
                    });
                } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    video.src = url;
                    video.play();
                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø³ÙŠØ·Ø© Ù„Ù„Ø¢ÙŠÙÙˆÙ†
                    video.onerror = () => {
                        currentIdx++;
                        tryUrl();
                    };
                }
            }
            tryUrl();
        }

        function closePlayer() {
            document.getElementById('player-modal').style.display = 'none';
            player.stop();
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (Ø¨Ø­Ø«ØŒ Ù…ÙØ¶Ù„Ø©ØŒ ÙÙ„ØªØ±)
        function toggleFav(name, e) {
            e.stopPropagation();
            if(favs.includes(name)) favs = favs.filter(n => n !== name);
            else favs.push(name);
            localStorage.setItem('favs_v4', JSON.stringify(favs));
            render(allData); // ØªØ­Ø¯ÙŠØ« Ø³Ø±ÙŠØ¹
        }

        function filterCat(cat, btn) {
            document.querySelectorAll('.tag').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            let res = (cat === 'all') ? allData : (cat === 'fav') ? allData.filter(x => favs.includes(x.name)) : allData.filter(x => x.category === cat);
            render(res);
        }

        function filterChannels() {
            let q = document.getElementById('search').value.toLowerCase();
            render(allData.filter(x => x.name.toLowerCase().includes(q)));
        }
    </script>
</body>
</html>
